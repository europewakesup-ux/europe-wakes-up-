<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EUROPE WAKES UP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background-color: #ffffff;
            color: #000000;
            line-height: 1.5;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            padding: 80px 40px 60px;
            background-color: #ffffff;
            border-bottom: 1px solid #e5e5e5;
        }
        
		.brand-icon {
			width: 18px;
			height: 18px;
			margin: 0 auto 12px;
			color: #000000;
		}
        
        .main-title {
            font-size: 4rem;
            font-weight: 300;
            color: #000000;
            margin-bottom: 20px;
            letter-spacing: -2px;
            line-height: 1.1;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #666666;
            font-weight: 400;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }
		
		/* Merch image support for real images */
		.merch-image img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			display: block;
        }
        
        .country-selector {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 40px;
        }
        
        .selector-title {
            font-size: 0.9rem;
            color: #666666;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .country-filters {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .country-filter {
    padding: 12px 16px;  /* Reduce padding */
    border: none;  /* Remove border */
    background-color: transparent;  /* Remove background */
    color: #666666;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    font-weight: 700;  /* Make bold */
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.country-filter:hover {
    color: #000000;
}

.country-filter.active {
    background-color: transparent;  /* Keep transparent */
    color: #000000;
    border-bottom: 2px solid #000000;  /* Optional: underline for active state */
}
		.country-filters {
    display: flex;
    gap: 8px;  /* Reduce gap between items */
    flex-wrap: nowrap;  /* Force single line */
    align-items: center;
    overflow-x: auto;  /* Allow horizontal scroll on mobile if needed */
}
        
        .main-container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px;
            gap: 60px;
        }
        
        .sidebar-left {
            width: 200px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            align-self: flex-start;
            height: fit-content;
        }
        
        .merchandise {
            margin-bottom: 40px;
        }
        
        .merch-title {
            font-size: 0.9rem;
            color: #000000;
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .merch-item {
            display: block;
            margin-bottom: 16px;
            padding: 20px;
            border: 1px solid #e5e5e5;
            background: #ffffff;
            transition: all 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            text-align: center;
        }
        
        .merch-item:hover {
            border-color: #000000;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .merch-image {
            width: 100%;
            height: 120px;
            background-color: #f5f5f5;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #666;
        }
        
        .merch-name {
            font-size: 0.85rem;
            font-weight: 500;
            color: #000000;
            margin-bottom: 4px;
        }
        
        .merch-price {
            font-size: 0.8rem;
            color: #666666;
        }
        
        .news-feed {
            flex: 1;
            padding: 0 20px;
        }
        
        .news-item {
            border-bottom: 1px solid #e5e5e5;
            margin-bottom: 40px;
            padding-bottom: 40px;
            transition: all 0.3s ease;
            animation: fadeIn 0.6s ease-out;
        }
        
        .news-item:hover {
            transform: translateY(-2px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .news-title {
            font-size: 1.5rem;
            color: #000000;
            margin-bottom: 12px;
            line-height: 1.3;
            font-weight: 400;
            letter-spacing: -0.5px;
        }
        
        .news-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .news-title a:hover {
            color: #666666;
        }
        
        .news-meta {
            display: flex;
            gap: 20px;
            font-size: 0.8rem;
            color: #666666;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .news-source {
            color: #000000;
        }
        
        .news-excerpt {
            color: #333333;
            font-size: 1rem;
            line-height: 1.6;
            font-weight: 400;
            display: -webkit-box;
            -webkit-line-clamp: 8;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .more-label {
            color: #9aa0a6;
            font-size: 0.9rem;
            margin-top: 6px;
            display: inline-block;
        }
        
        .sidebar-right {
            width: 220px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            align-self: flex-start;
            height: fit-content;
        }
        
        .stats-container {
            margin-bottom: 40px;
        }
        
        .stat-item {
            margin-bottom: 32px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #666666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 2.2rem;
            color: #000000;
            font-weight: 300;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            letter-spacing: -1px;
        }
        
        .timer-value {
            color: #000000;
        }
        
        .europe-map {
            margin-top: 40px;
        }
        
        .map-title {
            font-size: 0.8rem;
            color: #666666;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        #map {
            width: 100%;
            max-width: 220px;
            border: 1px solid #e5e5e5;
            background: #fafafa;
            overflow: hidden;
        }
        #map svg {
            display: block;
            width: 100%;
            height: auto;
        }
        #map svg path {
            fill: #f0f0f0;
            stroke: #cccccc;
            stroke-width: 0.5;
            cursor: pointer;
            transition: fill 0.2s ease, opacity 0.2s ease;
        }
        #map svg path:hover {
            opacity: 0.9;
        }
        .map-legend {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #666666;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-bar {
            flex: 1;
            height: 8px;
            background: linear-gradient(90deg, rgb(255,240,240), rgb(255,0,0));
            border: 1px solid #e5e5e5;
        }
        
        .loading-indicator {
            text-align: center;
            padding: 60px;
            color: #666666;
            font-style: italic;
            font-size: 0.9rem;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 1px solid #e5e5e5;
            border-radius: 50%;
            border-top-color: #000000;
            animation: spin 1s ease-in-out infinite;
            margin-right: 12px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 40px 20px;
                gap: 40px;
            }
            
            .sidebar-left, .sidebar-right {
                width: 100%;
                position: static;
            }
            
            .main-title {
                font-size: 2.5rem;
            }
            
            .country-selector {
                padding: 0 20px;
            }
            
            .merchandise {
                display: flex;
                gap: 16px;
            }
            
            .merch-item {
                flex: 1;
            }
            
            #map {
                width: 100%;
                height: 200px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
		<div class="brand-icon" aria-hidden="true">
			<svg viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg">
				<line x1="12" y1="4" x2="12" y2="20" stroke="currentColor" stroke-width="2"/>
				<line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2"/>
			</svg>
		</div>
        <h1 class="main-title" id="siteTitle">EUROPE WAKES UP</h1>
		<p class="subtitle" id="siteSubtitle">United as One Against the Silent War</p>
    </div>
    
    <div class="country-selector">
        <div class="selector-title">Filter by Country</div>
        <div class="country-filters">
			<div class="country-filter active" data-country="all" data-title="EUROPE WAKES UP" data-subtitle="United as One Against the Silent War">All Europe</div>
			<div class="country-filter" data-country="spain" data-title="España, despierta" data-subtitle="Unidos como Uno contra la Guerra Silenciosa">Spain</div>
			<div class="country-filter" data-country="uk" data-title="England, Wake Up" data-subtitle="United as One Against the Silent War">United Kingdom</div>
			<div class="country-filter" data-country="france" data-title="France, Réveille-toi" data-subtitle="Unis como Un contre la Guerre Silencieuse">France</div>
			<div class="country-filter" data-country="germany" data-title="Deutschland, Wach Auf" data-subtitle="Vereint als Eins gegen den Stillen Krieg">Germany</div>
			<div class="country-filter" data-country="italy" data-title="Italia, Svegliati" data-subtitle="Uniti come Uno contro la Guerra Silenziosa">Italy</div>
			<div class="country-filter" data-country="netherlands" data-title="Nederland, Ontwaak" data-subtitle="Verenigd als Eén tegen de Stille Oorlog">Netherlands</div>
			<div class="country-filter" data-country="sweden" data-title="Sverige, Vakna" data-subtitle="Förenade som En mot det Tysta Kriget">Sweden</div>
			<div class="country-filter" data-country="portugal" data-title="Portugal, Acorda" data-subtitle="Unidos como Um contra a Guerra Silenciosa">Portugal</div>
        </div>
    </div>
    
    <div class="main-container">
        <aside class="sidebar-left">
            <div class="merchandise">
                <h3 class="merch-title">Support the Cause</h3>
                <div class="merch-item" onclick="alert('Security First Hoodie - would redirect to shop')">
					<div class="merch-image"><img id="hoodieImage" src="assets/hoodie.png" alt="EUROPE WAKES UP Hoodie" /></div>
                    <div class="merch-name">Security First Hoodie</div>
                    <div class="merch-price">€45</div>
                </div>
                <div class="merch-item" onclick="alert('Border Control Tee - would redirect to shop')">
					<div class="merch-image"><img id="teeImage" src="assets/tee.png" alt="EUROPE WAKES UP T-Shirt" /></div>
                    <div class="merch-name">Border Control Tee</div>
                    <div class="merch-price">€25</div>
                </div>
            </div>
        </aside>
        
        <main class="news-feed" id="newsFeed">
            <!-- News items will be populated here -->
        </main>
        
        <aside class="sidebar-right">
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-label">Time Since Last News</div>
                    <div class="stat-value timer-value" id="lastNewsTimer">00:00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Crime Incidents 2024</div>
                    <div class="stat-value" id="incidentCounter">847,293</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Stories Today</div>
                    <div class="stat-value" id="storyCounter">0</div>
                </div>
            </div>
            
            <div class="europe-map">
                <div class="map-title">Stories by Country</div>
                <div id="map">
<?xml version="1.0"?><svg baseprofile="tiny" fill="#ececec" height="684" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width=".1" version="1.2" viewBox="0 0 1000 684" width="1000" xmlns="http://www.w3.org/2000/svg">
 <path d="M654.7 528.1l0.5 0.4 2 2.9 1.4 0.5 1.9 1.3 1.4 3.2 0.1 2.2-0.5 2.6 0.3 2.1-0.8 0.8 0.7 2 0.2 1.9 1.2 2.2 1.2 1.1 1.3 2.4 1.6-0.2 1.3 1.1 0 1.1 1.1 1.8-0.8 2.6-1.7 0.8-1.2 3.1-0.3 2-0.6 0.5-1.9 0.3-1.7 1.3 1 2.2-0.9 0.7-0.3 1.5-0.7 0.7-2.7-0.9-0.7-2.5-1.7-2.7-4.9-2.6-1.2-1.1 0.4-1.5-0.1-1.4-1.4-2.4 0.3-2.6 0.8-2.2-0.3-2.7 0.1-2.1-0.7-2.9 0.5-2.1 0.9-1.3-0.2-2.2-1.5-1.1-1.6-0.2 0-3.1-0.3-0.6 1.7 0-1.7-2.8 3.2-5.3 1.1 0.3 0.8 2.1 3.4-1.2z" id="AL" name="Albania">
 </path>
 <path d="M654.7 528.1l0.5 0.4 2 2.9 1.4 0.5 1.9 1.3 1.4 3.2 0.1 2.2-0.5 2.6 0.3 2.1-0.8 0.8 0.7 2 0.2 1.9 1.2 2.2 1.2 1.1 1.3 2.4 1.6-0.2 1.3 1.1 0 1.1 1.1 1.8-0.8 2.6-1.7 0.8-1.2 3.1-0.3 2-0.6 0.5-1.9 0.3-1.7 1.3 1 2.2-0.9 0.7-0.3 1.5-0.7 0.7-2.7-0.9-0.7-2.5-1.7-2.7-4.9-2.6-1.2-1.1 0.4-1.5-0.1-1.4-1.4-2.4 0.3-2.6 0.8-2.2-0.3-2.7 0.1-2.1-0.7-2.9 0.5-2.1 0.9-1.3-0.2-2.2-1.5-1.1-1.6-0.2 0-3.1-0.3-0.6 1.7 0-1.7-2.8 3.2-5.3 1.1 0.3 0.8 2.1 3.4-1.2z" id="AL" name="Albania">
 </path>
</svg>
				</div>
				<div class="map-legend">
					<span id="legendMin">0</span>
					<div class="legend-bar"></div>
					<span id="legendMax">0</span>
                </div>
            </div>
        </aside>
    </div>
    
    <div class="loading-indicator" id="loadingIndicator">
        <div class="loading-spinner"></div>
        Loading more security news...
    </div>

    <script>
        /** === Config === **/
        const API_BASE = "https://europe-wakes-up.onrender.com"; // backend en Render
        const countryKeyToISO = {
          all: null, spain: "ES", uk: "GB", france: "FR",
          germany: "DE", italy: "IT", netherlands: "NL",
          sweden: "SE", portugal: "PT"
        };
        const isoToKey = { ES:'spain', GB:'uk', FR:'france', DE:'germany', IT:'italy', NL:'netherlands', SE:'sweden', PT:'portugal' };
        
        let activeCountry = 'all';
        let lastNewsTime = new Date(); // legacy
        const latestPublishedAtMsByCountry = {};
 
        function toMs(dateLike) {
            const d = new Date(dateLike);
            const ms = d.getTime();
            return Number.isFinite(ms) ? ms : 0;
        }
 
        function maybeResetTimerWithForCountry(countryKey, newMs) {
            if (!countryKey) return;
            const current = latestPublishedAtMsByCountry[countryKey] || 0;
            if (newMs > current) latestPublishedAtMsByCountry[countryKey] = newMs;
        }

        function getActiveBaselineMs() {
            const key = activeCountry || 'all';
            return latestPublishedAtMsByCountry[key] || 0;
        }
        
        /** === Utilidades UI === **/
        function updateLatestTimerFor(countryKey, items){
          if (!Array.isArray(items) || items.length === 0) return;
        
          const newestTs = Math.max(...items.map(a => +new Date(a.publishedAt || 0)).filter(n => Number.isFinite(n)));
          const prevTs = latestPublishedAtMsByCountry[countryKey] || 0;
        
          if (Number.isFinite(newestTs) && newestTs > prevTs){
            latestPublishedAtMsByCountry[countryKey] = newestTs;
            lastNewsTime = new Date(newestTs);
          } else if (!prevTs && Number.isFinite(newestTs)) {
            latestPublishedAtMsByCountry[countryKey] = newestTs;
            lastNewsTime = new Date(newestTs);
          }
        }
                
        function formatTime(seconds){
          const h = Math.floor(seconds/3600), m = Math.floor((seconds%3600)/60), s = seconds%60;
          return h>0 ? `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
                     : `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }
        function tickTimer(){
          const secs = Math.floor((new Date()-lastNewsTime)/1000);
          const el = document.getElementById('lastNewsTimer');
          if (el) el.textContent = formatTime(secs);
        }
        
        /** === Render de noticias === **/
        function renderNews(items){
          const feed = document.getElementById('newsFeed');
          const fmt = (d)=> d ? new Date(d).toLocaleString() : '';
          feed.innerHTML = (items||[]).map(a => `
            <article class="news-item" data-country="${(isoToKey[a.country]||'all')}">
              <h2 class="news-title">
                <a href="${a.url}" target="_blank" rel="noopener">${a.title || '(untitled)'}</a>
              </h2>
              <div class="news-meta">
                <span class="news-source">${a.source || a.domain || ''}</span>
                ${a.country ? `<span class="news-country">${a.country}</span>` : ''}
                <span class="news-time">${fmt(a.publishedAt)}</span>
              </div>
              ${a.summary ? `<p class="news-excerpt">${a.summary}</p>` : ''}
            </article>
          `).join('');
          document.getElementById('storyCounter').textContent = (items||[]).length;
          lastNewsTime = new Date();
        }
        
        /** === Llamadas API === **/
        async function loadNewsFromAPI(countryKey='all', q=''){
          const iso = countryKeyToISO[countryKey] || '';
          const params = new URLSearchParams();
          if (iso) params.set('country', iso);
          if (q) params.set('q', q);
          const res = await fetch(`${API_BASE}/api/news?`+params.toString());
          const items = await res.json();
          updateLatestTimerFor(countryKey, items);
          renderNews(items);
        }
        
        function colorFor(count, max){
          const t = max ? count/max : 0;           // 0..1
          const r = 255;
          const g = Math.round(240 - 200*t);
          const b = Math.round(240 - 200*t);
          return `rgb(${r},${g},${b})`;            // claro -> rojo
        }
        
        async function fetchCountsAndColor(){
          const r = await fetch(`${API_BASE}/api/counts`);
          const { counts = {}, lastUpdated } = await r.json();
          const max = Math.max(1, ...Object.values(counts));
        
          // colorear paths por id ISO2
          document.querySelectorAll('#map svg path[id]').forEach(p => {
            const iso = p.id.toUpperCase();
            const c = counts[iso] || 0;
            p.style.fill = colorFor(c, max);
            p.setAttribute('data-count', String(c));
            p.setAttribute('title', `${iso}: ${c}`);
          });
        
          const legendMax = document.getElementById('legendMax');
          if (legendMax) legendMax.textContent = String(max);
        
          const updatedEl = document.getElementById('updated');
          if (updatedEl && lastUpdated) updatedEl.textContent = `Updated: ${new Date(lastUpdated).toLocaleString()}`;
        }
        
        /** === Wiring UI === **/
        function updateSiteTitle(title){ document.getElementById('siteTitle').textContent = title; document.title = title; }
        function updateSubtitle(text){ const el = document.getElementById('siteSubtitle'); if (el && text) el.textContent = text; }
        
        document.addEventListener('DOMContentLoaded', () => {
          // Botones de filtro por país
          document.querySelectorAll('.country-filter').forEach(btn => {
            btn.addEventListener('click', async function(){
              document.querySelectorAll('.country-filter').forEach(f => f.classList.remove('active'));
              this.classList.add('active');
              activeCountry = this.dataset.country || 'all';
              updateSiteTitle(this.dataset.title || 'EUROPE WAKES UP');
              if (this.dataset.subtitle) updateSubtitle(this.dataset.subtitle);
              await loadNewsFromAPI(activeCountry);
              fetchCountsAndColor();
            });
          });
        
          // Click en mapa → aplica filtro
          const isoToCountry = { GB:'uk', FR:'france', DE:'germany', ES:'spain', IT:'italy', NL:'netherlands', SE:'sweden', PT:'portugal' };
          document.querySelectorAll('#map svg path[id]').forEach(p=>{
            const iso = p.id.toUpperCase();
            const key = isoToCountry[iso];
            if (!key) return;
            p.addEventListener('click', () => {
              const filter = document.querySelector(`.country-filter[data-country="${key}"]`);
              if (filter) filter.click();
            });
          });
        
          // Cargas iniciales
          loadNewsFromAPI('all');     // Europa entera
          fetchCountsAndColor();      // colorear mapa
          setInterval(fetchCountsAndColor, 60_000); // refresca cada minuto
          setInterval(tickTimer, 1000);             // cronómetro "last news"
        });
        </script>
</body>
</html>
